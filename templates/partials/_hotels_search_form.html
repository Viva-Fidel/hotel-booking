{% load static %}
<link
  rel="stylesheet"
  type="text/css"
  href="{% static 'css/partials/_hotels_search_form.css' %}"
/>

<!-- Connecting styles for autocomplete JS search script -->
<link
  rel="stylesheet"
  href="{% static 'node_modules/@trevoreyre/autocomplete-js/dist/style.css' %}"
/>

<!-- Connecting styles for JS calendar script -->
<link
  rel="stylesheet"
  href="{% static 'node_modules/flatpickr/dist/flatpickr.min.css' %}"
/>

<form
  class="booking-search-form"
  method="get"
  action="{% url 'search_hotels' %}"
>
  <div class="booking-search-form__item booking-search-form__item__geo" id="booking-search-form__item-geo">
    <img
      src="{% static 'images/partials/icons/_hotels_search_form/geo_gray.svg' %}"
      alt="Geolocation icon"
      class="booking-search-form__item-icon"
    />
    <input
      type="text"
      class="booking-search-form__geo-input"
      id="destination"
      name="destination"
      placeholder="Where are you going?"
      required
    />
    <ul class="autocomplete-result-list"></ul>
  </div>

  <div class="booking-search-form__item booking-search-form__item__calendar">
    <img
      src="{% static 'images/partials/icons/_hotels_search_form/calendar_gray.svg' %}"
      alt="Calendar icon"
      class="booking-search-form__item-icon"
    />
    <input
      type="text"
      id="checkin"
      name="checkin"
      placeholder="Check-in date"
      required
    />
  </div>
  <div class="booking-search-form__item booking-search-form__item__calendar">
    <img
      src="{% static 'images/partials/icons/_hotels_search_form/calendar_gray.svg' %}"
      alt="Calendar icon"
      class="booking-search-form__item-icon"
    />
    <input
      type="text"
      id="checkout"
      name="checkout"
      placeholder="Check-out date"
      required
    />
  </div>
  <div class="booking-search-form__item booking-search-form__item__guests" onload="setGuests()">
    <img
      src="{% static 'images/partials/icons/_hotels_search_form/guests_gray.svg' %}"
      alt="Guests icon"
      class="booking-search-form__item-icon"
    />
    <input
      type="text"
      id="guests"
      name="guests"
      placeholder="Guests & Rooms"
      readonly
    />
    <div
      class="booking-search-form__drop-down-menu"
      id="guests-input-container-dropdown-menu"
    >
      <div class="booking-search-form__drop-down-menu-item">
        <span class="booking-search-form__drop-down-menu-label">Adults</span>
        <div class="booking-search-form__drop-down-menu-choice_container">
          <button
            type="button"
            class="booking-search-form__drop-down-menu-button-minus"
            onclick="changeCount('adults', 'minus')"
            disabled
          >
            -
          </button>
          <span
            id="adults-count"
            class="booking-search-form__drop-down-menu-count"
            onchange="updateGuestsInput()"
            >1</span
          >
          <button
            type="button"
            class="booking-search-form__drop-down-menu-button-plus"
            onclick="changeCount('adults', 'plus')"
          >
            +
          </button>
        </div>
      </div>
      <div class="booking-search-form__drop-down-menu-item">
        <span class="booking-search-form__drop-down-menu-label">Children</span>
        <div class="booking-search-form__drop-down-menu-choice_container">
          <button
            type="button"
            class="booking-search-form__drop-down-menu-button-minus"
            onclick="changeCount('children', 'minus')"
            disabled
          >
            -
          </button>
          <span
            id="children-count"
            class="booking-search-form__drop-down-menu-count"
            onchange="updateGuestsInput()"
            >0</span
          >
          <button
            type="button"
            class="booking-search-form__drop-down-menu-button-plus"
            onclick="changeCount('children', 'plus')"
          >
            +
          </button>
        </div>
      </div>
      <div class="booking-search-form__drop-down-menu-item">
        <span class="booking-search-form__drop-down-menu-label">Rooms</span>
        <div class="booking-search-form__drop-down-menu-choice_container">
          <button
            type="button"
            class="booking-search-form__drop-down-menu-button-minus"
            onclick="changeCount('rooms', 'minus')"
            disabled
          >
            -
          </button>
          <span
            id="rooms-count"
            class="booking-search-form__drop-down-menu-count"
            onchange="updateGuestsInput()"
            >1</span
          >
          <button
            type="button"
            class="booking-search-form__drop-down-menu-button-plus"
            onclick="changeCount('rooms', 'plus')"
          >
            +
          </button>
        </div>
      </div>
    </div>
  </div>
  <button type="submit" class="booking-search-form__submit-button">
    Search
  </button>
</form>

<!-- Autocomplete script to search destinations -->
<script src="{% static 'node_modules/@trevoreyre/autocomplete-js/dist/autocomplete.min.js' %}"></script>
<script src="{% static 'js/partials/_hotels_search_form/county_autocomplete.js' %}"></script>

<!-- Script to showing calendar to choose check in and check out dates -->
<script src="{% static 'node_modules/flatpickr/dist/flatpickr.js' %}"></script>
<script src="{% static 'js/partials/_hotels_search_form/calendar.js' %}"></script>

<!-- Script to show or hide drop down menu for choosing amount of guests -->
<script>
  const guest = document.getElementById("guests"); // Get the element with the id "guests"
  const guestdropdownMenu = document.getElementById(
    "guests-input-container-dropdown-menu"
  ); // Get the element with the id "guests-input-container-dropdown-menu"

  guest.addEventListener("click", function () {
    // Add a click event listener to the "guest" element
    guestdropdownMenu.classList.toggle("show"); // Toggle the "show" class on the "guestdropdownMenu" element
  });

  document.addEventListener("click", function (event) {
    // Add a click event listener to the document
    const isClickInside =
      guest.contains(event.target) || guestdropdownMenu.contains(event.target); // Check if the click event happened inside the "guest" element or the "guestdropdownMenu" element
    if (!isClickInside) {
      guestdropdownMenu.classList.remove("show"); // If the click event didn't happen inside either element, remove the "show" class from the "guestdropdownMenu" element
    }
  });
</script>

<!-- Script to choose guests amount -->
<script>
  function changeCount(type, operation) {
    // Get the HTML element of the count
    var countEl = document.getElementById(type + "-count");
    // Parse the current count as an integer
    var count = parseInt(countEl.innerHTML);
    // Get the minus and plus buttons for the current type
    var minusButton = document.querySelector(
      `button.booking-search-form__drop-down-menu-button-minus[onclick="changeCount('${type}', 'minus')"]`
    );
    var plusButton = document.querySelector(
      `button.booking-search-form__drop-down-menu-button-plus[onclick="changeCount('${type}', 'plus')"]`
    );

    // Decrease the count if operation is minus and count is greater than zero
    if (operation === "minus") {
      if (count > 0) {
        count--;
      }
    }
    // Increase the count if operation is plus and count is less than 30
    else if (operation === "plus") {
      if (count < 30) {
        count++;
      }
    }

    // Update the count in the HTML element
    countEl.innerHTML = count;
    // Call the setGuests() function to update the guest count in the input field
    setGuests();

    // Disable the minus button if the count is at its minimum value
    if (type === "adults" && count === 1) {
      minusButton.disabled = true;
    } else if (type === "children" && count === 0) {
      minusButton.disabled = true;
    } else if (type === "rooms" && count === 1) {
      minusButton.disabled = true;
    } else {
      minusButton.disabled = false;
    }

    // Disable the plus button if the count is at its maximum value
    if (count === 30) {
      plusButton.disabled = true;
    } else {
      plusButton.disabled = false;
    }
  }


  // Event listener for the search button click
document.getElementsByClassName("booking-search-form__submit-button")[0].addEventListener("click", function(event) {
  // Get the guest count values
  var adults = parseInt(document.getElementById("adults-count").textContent);
  var children = parseInt(document.getElementById("children-count").textContent);
  var rooms = parseInt(document.getElementById("rooms-count").textContent);
  
  if ((adults === 1 && children === 0 && rooms === 1)) {
    var totalGuests = parseInt(adults) + parseInt(children);
    var guestsLabel = " guest";
    var roomsLabel = " room";

    document.getElementById("guests").value =
      totalGuests + guestsLabel + " · " + rooms + roomsLabel;
  }
  
  
});

  // Function to set the guest count in the input field
  function setGuests() {
    // Get the count of adults, children, and rooms
    var adults = document.getElementById("adults-count").textContent;
    var children = document.getElementById("children-count").textContent;
    var rooms = document.getElementById("rooms-count").textContent;
    // Calculate the total number of guests
    var totalGuests = parseInt(adults) + parseInt(children);
    // Set the label for guests depending on whether there is one guest or multiple guests
    var guestsLabel = totalGuests === 1 ? " guest" : " guests";
    // Set the label for rooms depending on whether there is one room or multiple rooms
    var roomsLabel = rooms === "1" ? " room" : " rooms";
    // Set the value of the input field with the guest count and room count labels
    document.getElementById("guests").value =
      totalGuests + guestsLabel + " · " + rooms + roomsLabel;
    
  }
</script>

{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>my Dream Place | Search results</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'images/core/favicon/favicon.ico' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'css/normalize.css' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'css/core/search_results.css' %}"
    />
    <!-- <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    /> -->
  </head>

  <body>
    <header class="header">
      <div class="container">
        <div class="header__background">
          <a href="{% url 'home' %}" class="header__logo-link">
            <img
              src="{% static 'images/logos/alternative_logo.svg' %}"
              class="header__logo-image"
              alt="Website logo"
            />
            <span class="header__logo-text">my Dream Place</span>
          </a>

          <nav class="header-menu">
            <ul class="header-menu__list">
              <li class="header-menu__item">
                <a href="{% url 'home' %}" class="header-menu__link">Home</a>
              </li>
              <li class="header-menu__item">
                <a href="/discover" class="header-menu__link">Discover</a>
              </li>
              <li class="header-menu__item">
                <a href="/activities" class="header-menu__link">Activities</a>
              </li>
              <li class="header-menu__item">
                <a href="/about" class="header-menu__link">About</a>
              </li>
              <li class="header-menu__item">
                <a href="/contact" class="header-menu__link">Contact</a>
              </li>
            </ul>
          </nav>
          {% if user.is_authenticated %}
          <div class="header-user-profile-container">
            <img
              src="{% static 'images/core/icons/notification.svg' %}"
              alt="User notification"
              class="header-user-profile-container__notifications-icon"
            />
            <div class="header-user-profile-container__user-avatar">
              <img
                src="{{ user.avatar.url }}"
                class="header-user-profile-container_user-photo"
                alt="User Image"
                id="dropdown-trigger"
              />
              <div
                class="header-user-profile-container__dropdown-menu"
                id="dropdown-menu"
              >
                <div
                  class="header-user-profile-container__dropdown-menu-item-container"
                >
                  <a
                    href="/account/"
                    class="header-user-profile-container__dropdown-menu-item-link"
                  >
                    <img
                      src="{% static 'images/partials/icons/account.svg' %}"
                      alt="Account icon"
                      class="header-user-profile-container__dropdown-menu-link-item-icon"
                    />
                    <span
                      class="header-user-profile-container__dropdown-menu-link-item-text"
                      >Manage account</span
                    >
                  </a>
                </div>
                <div
                  class="header-user-profile-container__dropdown-menu-item-container"
                >
                  <a
                    href="/reservations/"
                    class="header-user-profile-container__dropdown-menu-item-link"
                  >
                    <img
                      src="{% static 'images/partials/icons/trips.svg' %}"
                      alt="Account icon"
                      class="header-user-profile-container__dropdown-menu-link-item-icon"
                    />
                    <span
                      class="header-user-profile-container__dropdown-menu-link-item-text"
                      >My trips</span
                    >
                  </a>
                </div>
                <div
                  class="header-user-profile-container__dropdown-menu-item-container"
                >
                  <a
                    href="/rewards/"
                    class="header-user-profile-container__dropdown-menu-item-link"
                  >
                    <img
                      src="{% static 'images/partials/icons/wallet.svg' %}"
                      alt="Account icon"
                      class="header-user-profile-container__dropdown-menu-link-item-icon"
                    />
                    <span
                      class="header-user-profile-container__dropdown-menu-link-item-text"
                      >Reward and wallet</span
                    >
                  </a>
                </div>
                <div
                  class="header-user-profile-container__dropdown-menu-item-container"
                >
                  <a
                    href="{% url 'logout' %}"
                    class="header-user-profile-container__dropdown-menu-item-link"
                  >
                    <img
                      src="{% static 'images/partials/icons/signout.svg' %}"
                      alt="Account icon"
                      class="header-user-profile-container__dropdown-menu-link-item-icon"
                    />
                    <span
                      class="header-user-profile-container__dropdown-menu-link-item-text"
                      >Sign out</span
                    >
                  </a>
                </div>
              </div>
            </div>
          </div>
          {% else %}

          <div class="header-button-container">
            <a href="/register" class="register-link"
              ><button class="header-button-container__register-button">
                Register
              </button></a
            >
            <a href="/signin" class="signin-link"
              ><button class="header-button-container__signin-button">
                Sign In
              </button></a
            >
          </div>
          {% endif %} {% include 'partials/_search_form.html' %}
        </div>
      </div>
    </header>
    {% block content %}
    <main class="main">
      <section class="search-results">
        <div class="container">
          <div class="page-content">
            <div class="page-content__left-side">
              <div class="page-content__filters-container">
                <div
                  class="page-content__filter-search-container"
                  id="page-content__filter-search-geo"
                >
                  <h4 class="page-content__filter-search-title">
                    <b>Search by property name</b>
                  </h4>
                  <img
                    src="{% static 'images/core/icons/search.svg' %}"
                    alt="Guests icon"
                    class="page-content__filter-search-icon"
                  />
                  <input
                    type="text"
                    class="page-content__filter-search-input"
                    placeholder="e.g. Hilton"
                    name="hotel-search-input"
                    id="hotel-search-input"
                  />
                </div>
              </div>
              <h4 class="page-content__filter-by-title">Filter by</h4>
              <div class="page-content__filter-container">
                <div class="page-content__filter-container-title">
                  <b>Your budget per day</b>
                </div>
                <ul
                  class="page-content__filter-choice-list"
                  id="price-choice-list"
                >
                  {% for price in price_ranges %}
                  <li>
                    <input
                      type="checkbox"
                      name="price-range"
                      value="{{ price.value }}"
                      class="page-content__filter-choice-list-item__price-range"
                    />
                    {{ price.label }}
                    <span>{{ price.count }}</span>
                  </li>
                  {% endfor %}
                  <!-- <div
                    class="page-content__budget-per-day-filter-set-budget-switch-container"
                  >
                    <label for="set-budget">Set your own budget</label>
                    <label
                      class="page-content__budget-per-day-filter-set-budget-switch"
                    >
                      <input type="checkbox" />
                      <span
                        class="page-content__budget-per-day-filter-set-budget-switch-slider"
                      ></span>
                    </label>
                  </div> -->
                </ul>
              </div>
              <div class="page-content__filter-container">
                <div class="page-content__filter-container-title">Rating</div>
                <div class="page-content__filter-choice-list">
                  <span class="page-content__filter-container-text"
                    >Show only ratings more than</span
                  >
                  <div
                    class="page-content__filter-by-rating-choice-stars-container"
                  >
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button page-content__filter-by-rating-choice-stars-button-left"
                    >
                      1
                      <img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button"
                    >
                      2<img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button"
                    >
                      3<img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button"
                    >
                      4<img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button page-content__filter-by-rating-choice-stars-button-right"
                    >
                      5<img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                  </div>
                </div>
              </div>
              <div class="page-content__filter-container">
                <div class="page-content__filter-container-title">
                  Facilities
                </div>
                <div
                  class="page-content__filter-choice-list"
                  id="facilities-choice-list"
                >
                  {% for facility in facilities %}
                  <li>
                    <input
                      type="checkbox"
                      name="facility-range"
                      value="{{ facility.value }}"
                      class="page-content__filter-choice-list__facility-range"
                    />
                    {{ facility.label }}
                    <span>{{ facility.count }}</span>
                  </li>
                  {% endfor %}
                </div>
              </div>
              <div class="page-content__filter-container">
                <div class="page-content__filter-container-title">
                  Activities
                </div>
                <ul
                  class="page-content__filter-choice-list"
                  id="activities-choice-list"
                >
                  {% for activity in activities %}
                  <li>
                    <input
                      type="checkbox"
                      name="activity-range"
                      value="{{ activity.value }}"
                      class="page-content__filter-choice-list__activity-range"
                    />
                    {{ activity.label }}
                    <span>{{ activity.count }}</span>
                  </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
            <div class="page-content__right-side">
              <h3 class="page-content__search-results-title">
                {{ destination }}:
                <span id="num-hotels-found">{{ num_hotels_found }}</span> search
                results found
              </h3>
              <div class="page-content__allocation-type-filter-container">
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button page-content__allocation-type-filter-button-left"
                >
                  Our top picks
                </button>
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button"
                >
                  Hotel and apartments
                </button>
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button"
                >
                  Residence
                </button>
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button"
                >
                  Resort
                </button>
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button page-content__allocation-type-filter-button-right"
                >
                  Shared Space
                </button>
                <div class="page-content__sort-by-container">
                  <span class="page-content__sort-by-container-text"
                    >Sort by:</span
                  >
                  <img
                    src="{% static 'images/core/icons/arrow-down.svg' %}"
                    alt="Arrow icon"
                    class="page-content__sort-by-container-icon"
                    id="sort-by-drop-down"
                  />
                  <span class="page-content__sort-by-container-choice"
                    >Recommended</span
                  >
                  <ul class="page-content__sort-by-drop-down-item-list">
                    <li class="page-content__sort-by-drop-down-item">
                      <span>Recommended</span>
                    </li>
                    <li class="page-content__sort-by-drop-down-item">
                      <span>Stars (high to low)</span>
                    </li>

                    <li class="page-content__sort-by-drop-down-item">
                      <span>Stars (low to high)</span>
                    </li>
                    <li class="page-content__sort-by-drop-down-item">
                      <span>Top reviewed</span>
                    </li>
                  </ul>
                </div>
              </div>
              <ul
                class="page-content__search-results-list"
                id="search-results-container"
              >
                {% for hotel_result in hotel_results %}
                <li class="page-content__search-results-item">
                  <img
                    src="{{ hotel_result.hotel_cover_photo.url }}"
                    alt="{{ hotel_result.hotel_name }}"
                    class="page-content__search-results-item-image"
                  />
                  <div class="page-content__search-results-item-info-container">
                    <div
                      class="page-content__search-results-item-info-title-container"
                    >
                      <h4 class="page-content__search-results-item-info-title">
                        {{ hotel_result.hotel_name }}
                      </h4>

                      {% if hotel_result.total_price_with_discount != 0 %}
                      <div
                        class="page-content__search-results-item-info-title-promo__active"
                      >
                        {{ hotel_result.special_discount }}
                      </div>
                      {% else %}
                      <div
                        class="page-content__search-results-item-info-title-promo__not-active"
                      ></div>
                      {% endif %}
                    </div>
                    <div
                      class="page-content__search-results-item-info-rating-container"
                    >
                      <div
                        class="page-content__search-results-item-info-rating-stars-container"
                      >
                        {% if hotel_result.hotel_rating >= 1 %}
                        <img
                          src="{% static 'images/core/icons/star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon"
                        />
                        {% endif %} {% if hotel_result.hotel_rating >= 2 %}
                        <img
                          src="{% static 'images/core/icons/star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon"
                        />
                        {% endif %} {% if hotel_result.hotel_rating >= 3 %}
                        <img
                          src="{% static 'images/core/icons/star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon"
                        />
                        {% endif %} {% if hotel_result.hotel_rating >= 4 %}
                        <img
                          src="{% static 'images/core/icons/star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon"
                        />
                        {% endif %} {% if hotel_result.hotel_rating >= 5 %}
                        <img
                          src="{% static 'images/core/icons/star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon"
                        />
                        {% endif %}
                      </div>
                      <p
                        class="page-content__search-results-item-info-rating-stars-text"
                      >
                        Guest rating: {{ hotel_result.user_rating }} ({{ hotel_result.amount_of_reviews }}
                        Reviews)
                      </p>
                    </div>
                    <div
                      class="page-content__search-results-item-info-data-container"
                    >
                      <div
                        class="page-content__search-results-item-info-data-container-left"
                      >
                        <p
                          class="page-content__search-results-item-info-data-offer-title"
                        >
                          {{ hotel_result.hotel_search_info_title }}
                        </p>
                        <p
                          class="page-content__search-results-item-info-data-offer-text"
                        >
                          {{ hotel_result.hotel_search_info_text }}
                        </p>
                        <button
                          type="submit"
                          class="page-content__search-results-item-info-data-see-availability"
                        >
                          See availability
                        </button>
                      </div>
                      <div
                        class="page-content__search-results-item-info-data-container-right"
                      >
                        {% if hotel_result.total_price_with_discount != 0 %}
                        <div
                          class="page-content__search-results-item-info-data-discount__active"
                        >
                          {{ hotel_result.price_discount }}% off
                        </div>
                        {% else %}
                        <div
                          class="page-content__search-results-item-info-data-discount__not-active"
                        ></div>
                        {% endif %}
                        <p
                          class="page-content__search-results-item-info-data-rooms-text"
                        >
                          {{ guests }} {{ duration }} days
                        </p>
                        {% if hotel_result.total_price_with_discount != 0 %}
                        <p
                          class="page-content__search-results-item-info-data-price-full"
                        >
                          US${{ hotel_result.total_price_with_discount }}
                        </p>
                        <p
                          class="page-content__search-results-item-info-data-price-discount__active"
                        >
                          US${{ hotel_result.total_price }}
                        </p>
                        {% else %}
                        <p
                          class="page-content__search-results-item-info-data-price-full"
                        >
                          US${{ hotel_result.total_price }}
                        </p>
                        <div
                          class="page-content__search-results-item-info-data-price-discount__not-active"
                        ></div>
                        {% endif %}

                        <!-- <div
                          class="page-content__search-results-item-info-data-price-container"
                        > -->
                        <p
                          class="page-content__search-results-item-info-data-taxes-text"
                        >
                          Includes taxes and fees
                        </p>
                      </div>
                    </div>
                  </div>
                </li>
                {% endfor %}
              </ul>
              <div class="more-results__button-container">
                <button type="button" class="more-results__button">
                  Load more results
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="restrictions">
        <div class="container">{% include 'partials/_warning.html' %}</div>
      </section>
    </main>

    {% endblock %} {% block footer %} {% include 'partials/_footer.html' %}
    {%endblock %}
  </body>
</html>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

{% if user.is_authenticated %}
<!-- Script to activate drop down menu when user clicks on the avatar -->
<script>
  // Get the avatar and dropdown menu elements by their IDs
  const avatar = document.getElementById("dropdown-trigger");
  const dropdownMenu = document.getElementById("dropdown-menu");

  // Add a click event listener to the avatar element
  avatar.addEventListener("click", function () {
    // Toggle the "show" class on the dropdown menu element to show or hide it
    dropdownMenu.classList.toggle("show");
  });

  // Add a click event listener to the document object
  document.addEventListener("click", function (event) {
    // Check if the click event occurred inside the avatar or dropdown menu elements
    const isClickInside =
      avatar.contains(event.target) || dropdownMenu.contains(event.target);
    // If the click event occurred outside of the avatar or dropdown menu elements, hide the dropdown menu
    if (!isClickInside) {
      dropdownMenu.classList.remove("show");
    }
  });
</script>
{% endif %}


<!-- <script>
  const dropDownList = document.querySelector(
    ".page-content__sort-by-drop-down-item-list"
  );
  const dropDownIcon = document.querySelector(
    ".page-content__sort-by-container-icon"
  );
  const sortByContainer = document.querySelector(
    ".page-content__sort-by-container"
  );
  const sortByChoice = document.querySelector(
    ".page-content__sort-by-container-choice"
  );

  // Hide the drop-down list on page load
  dropDownList.style.display = "none";

  // Toggle the drop-down list when the icon is clicked
  dropDownIcon.addEventListener("click", () => {
    if (dropDownList.style.display === "none") {
      dropDownList.style.display = "flex";
      dropDownIcon.classList.add("rotated");
    } else {
      dropDownList.style.display = "none";
      dropDownIcon.classList.remove("rotated");
    }
  });

  // Update the sort-by choice when an item is clicked
  dropDownList.addEventListener("click", (event) => {
    const selectedItem = event.target.closest("li");
    if (selectedItem) {
      sortByChoice.textContent = selectedItem.textContent.trim();
      dropDownList.style.display = "none";
      dropDownIcon.classList.remove("rotated");
    }
  });
</script> -->

<script>
  $(document).ready(function () {
  // Define variables to store the selected values
  let selectedPrices = null;
  let hotelRating = null;
  let selectedFacilities = null;
  let selectedActivities = null;
  let hotelType = null;
  let sorting = null; 
  let displayedHotels = 8;

  $(".more-results__button").click(function () {
    // Increase the number of displayed hotels by 4
    displayedHotels += 4;

    // Call the updateSearchResults function with the updated number of displayed hotels
    updateSearchResults();
  });

  // Add event listener to the hotel name input field
  $("#hotel-search-input").keypress(function (event) {
    if (event.which === 13) {
      // Enter key code
      event.preventDefault();
      updateSearchResults();
    }
  });

  const allocationButtons = document.querySelectorAll(".page-content__allocation-type-filter-button");

    allocationButtons.forEach((button) => {
      button.addEventListener("click", () => {
        if (button.classList.contains("selected")) {
          button.classList.remove("selected");
        } else {
          allocationButtons.forEach((otherButton) => {
            otherButton.classList.remove("selected");
          });
          button.classList.add("selected");
        }
        hotelType = getHotelType();
        updateSearchResults();
      });
    });

    function getHotelType() {
      const selectedButton = document.querySelector(
        ".page-content__allocation-type-filter-button.selected"
      );
      if (selectedButton) {
        return selectedButton.textContent.trim();
      }
      return null;
    }



  $(document).on(
    "change",
    ".page-content__filter-choice-list__facility-range",
    function () {
      selectedFacilities = [];
      $(".page-content__filter-choice-list__facility-range").each(function () {
        if ($(this).is(":checked")) {
          selectedFacilities.push($(this).val());
        }
      });
      updateSearchResults();
    }
  );

  $(document).on(
    "change",
    ".page-content__filter-choice-list__activity-range",
    function () {
      selectedActivities = [];
      $(".page-content__filter-choice-list__activity-range").each(function () {
        if ($(this).is(":checked")) {
          selectedActivities.push($(this).val());
        }
      });
      updateSearchResults();
    }
  );

  $(document).on(
    "change",
    ".page-content__filter-choice-list-item__price-range",
    function () {
      selectedPrices = [];
      $(".page-content__filter-choice-list-item__price-range").each(function () {
        if ($(this).is(":checked")) {
          selectedPrices.push($(this).val());
        }
      });
      updateSearchResults();
    }
  );

  const starButtons = document.querySelectorAll(
    ".page-content__filter-by-rating-choice-stars-button"
  );

  starButtons.forEach((button) => {
    button.addEventListener("click", () => {
      if (button.classList.contains("selected")) {
        button.classList.remove("selected");
      } else {
        starButtons.forEach((otherButton) => {
          otherButton.classList.remove("selected");
        });
        button.classList.add("selected");
      }
      hotelRating = getSelectedRating();
      updateSearchResults();
    });
  });

  function getSelectedRating() {
    const selectedButton = document.querySelector(
      ".page-content__filter-by-rating-choice-stars-button.selected"
    );
    if (selectedButton) {
      return parseInt(selectedButton.textContent.trim());
    }
    return null;
  }

  const dropDownList = document.querySelector(".page-content__sort-by-drop-down-item-list");
  const dropDownIcon = document.querySelector(".page-content__sort-by-container-icon");
  const sortByContainer = document.querySelector(".page-content__sort-by-container");
  const sortByChoice = document.querySelector(".page-content__sort-by-container-choice");

  // Hide the drop-down list on page load
  dropDownList.style.display = "none";

  // Toggle the drop-down list when the icon is clicked
  dropDownIcon.addEventListener("click", () => {
    if (dropDownList.style.display === "none") {
      dropDownList.style.display = "flex";
      dropDownIcon.classList.add("rotated");
    } else {
      dropDownList.style.display = "none";
      dropDownIcon.classList.remove("rotated");
    }
  });

  // Update the sort-by choice when an item is clicked
  dropDownList.addEventListener("click", (event) => {
    const selectedItem = event.target.closest("li");
    if (selectedItem) {
      sortByChoice.textContent = selectedItem.textContent.trim();
      dropDownList.style.display = "none";
      dropDownIcon.classList.remove("rotated");
      sorting = sortByChoice.textContent; // Set the sorting value based on the selected item
      updateSearchResults();
    }
  });

  function updateSearchResults() {
      // Get the search parameters from the URL
      var searchParams = new URLSearchParams(window.location.search);
      var destination = searchParams.get("destination");
      var checkin = searchParams.get("checkin");
      var checkout = searchParams.get("checkout");
      var guests = searchParams.get("guests");
      var hotelName = $("#hotel-search-input").val();

      // Create the AJAX request
      $.ajax({
        url: "/update-search-results/",
        type: "GET",
        data: {
          destination: destination,
          checkin: checkin,
          checkout: checkout,
          guests: guests,
          hotel_name: hotelName,
          price: (selectedPrices || []).join(","),
          hotel_rating: hotelRating,
          facilities: (selectedFacilities || []).join(","),
          activities: (selectedActivities || []).join(","),
          hotel_type: hotelType,
          sorting: sorting,
          displayed_hotels: displayedHotels,
        },
        dataType: "json",
        success: function (response) {
          // Parse the JSON response
          var data = response;
          var duration = data.duration;
          var guests = data.guests;
          var numHotelsFound = data.num_hotels_found;
          var priceRanges = data.price_ranges;
          var facilities = data.facilities;
          var activities = data.activities;
          var hotelResults = data.hotel_results;

          var checkedStatePrice = {};
          $("input[name='price-range']").each(function () {
            checkedStatePrice[$(this).val()] = $(this).is(":checked");
          });
          var checkedStateFacility = {};
          $("input[name='facility-range']").each(function () {
            checkedStateFacility[$(this).val()] = $(this).is(":checked");
          });

          var checkedStateActivity = {};
          $("input[name='activity-range']").each(function () {
            checkedStateActivity[$(this).val()] = $(this).is(":checked");
          });
          
          $; // Update the price range list
          $("#price-choice-list").empty();
          priceRanges.forEach(function (price) {
            var checked = checkedStatePrice[price.value] ? "checked" : "";
            var listItem = `
    <li>
      <input
        type="checkbox"
        name="price-range"
        value="${price.value}"
        class="page-content__filter-choice-list-item__price-range"
        ${checked}
      />
      ${price.label}
      <span>${price.count}</span>
    </li>
  `;
            $("#price-choice-list").append(listItem);
          });

          $("#facilities-choice-list").empty();
          facilities.forEach(function (facility) {
            var checked = checkedStateFacility[facility.value] ? "checked" : "";
            var listItem = `
    <li>
      <input
        type="checkbox"
        name="facility-range"
        value="${facility.value}"
        class="page-content__filter-choice-list__facility-range"
        ${checked}
      />
      ${facility.label}
      <span>${facility.count}</span>
    </li>
  `;
            $("#facilities-choice-list").append(listItem);
          });

          $("#activities-choice-list").empty();

          activities.forEach(function (activity) {
            var checked = checkedStateActivity[activity.value] ? "checked" : "";
            var listItem = `
              <li>
                <input
                  type="checkbox"
                  name="activity-range"
                  value="${activity.value}"
                  class="page-content__filter-choice-list__activity-range"
        ${checked}
                />
                ${activity.label}
                <span>${activity.count}</span>
              </li>
            `;

            // Append the list item to the price range list
            $("#activities-choice-list").append(listItem);
          });

          // Clear the existing search results
          $("#search-results-container").empty();

          if (hotelResults.length > 0) {
            // Loop through the hotel results and append the updated HTML
            hotelResults.forEach(function (hotelResult) {
              var html = "";

              // Generate the HTML for each hotel result
              html += `
                <li class="page-content__search-results-item">
                  <img
                    src="${hotelResult.hotel_cover_photo}"
                    alt="${hotelResult.hotel_name}"
                    class="page-content__search-results-item-image"
                  />
                  <div class="page-content__search-results-item-info-container">
                    <div class="page-content__search-results-item-info-title-container">
                      <h4 class="page-content__search-results-item-info-title">
                        ${hotelResult.hotel_name}
                      </h4>
                      ${
                        hotelResult.total_price_with_discount != 0
                          ? `
                            <div class="page-content__search-results-item-info-title-promo__active">
                              ${hotelResult.special_discount}
                            </div>
                          `
                          : `
                            <div class="page-content__search-results-item-info-title-promo__not-active"></div>
                          `
                      }
                    </div>

                    <div class="page-content__search-results-item-info-rating-container">
                      <div class="page-content__search-results-item-info-rating-stars-container">
                        
                      </div>
                      <p class="page-content__search-results-item-info-rating-stars-text">
                        Guest rating: ${hotelResult.user_rating} (${hotelResult.amount_of_reviews} Reviews)
                      </p>
                    </div>

                    <div class="page-content__search-results-item-info-data-container">
                      <div class="page-content__search-results-item-info-data-container-left">
                        <p class="page-content__search-results-item-info-data-offer-title">
                          ${hotelResult.hotel_search_info_title}
                        </p>
                        <p class="page-content__search-results-item-info-data-offer-text">
                          ${hotelResult.hotel_search_info_text}
                        </p>
                        <button type="submit" class="page-content__search-results-item-info-data-see-availability">
                          See availability
                        </button>
                      </div>
                      <div class="page-content__search-results-item-info-data-container-right">
                        ${
                          hotelResult.total_price_with_discount != 0
                            ? `
                              <div class="page-content__search-results-item-info-data-discount__active">
                                ${hotelResult.price_discount}% off
                              </div>
                            `
                            : `
                              <div class="page-content__search-results-item-info-data-discount__not-active"></div>
                            `
                        }
                        <p class="page-content__search-results-item-info-data-rooms-text">
                          ${guests} ${duration} days
                        </p>
                        ${
                          hotelResult.total_price_with_discount != 0
                            ? `
                              <p class="page-content__search-results-item-info-data-price-full">
                                US$${hotelResult.total_price_with_discount}
                              </p>
                              <p class="page-content__search-results-item-info-data-price-discount__active">
                                US$${hotelResult.total_price}
                              </p>
                            `
                            : `
                              <p class="page-content__search-results-item-info-data-price-full">
                                US$${hotelResult.total_price}
                              </p>
                              <div class="page-content__search-results-item-info-data-price-discount__not-active"></div>
                            `
                        }
                        <p class="page-content__search-results-item-info-data-taxes-text">
                          Includes taxes and fees
                        </p>
                      </div>
                    </div>
                  </div>
                </li>
              `;

              // Append star icons based on hotel rating
              var $hotelResultItem = $(html);
              $("#search-results-container").append($hotelResultItem);

              // Append star icons based on hotel rating
              var $ratingStarsContainer = $hotelResultItem.find(
                ".page-content__search-results-item-info-rating-stars-container"
              );
              for (var i = 0; i < hotelResult.hotel_rating; i++) {
                $ratingStarsContainer.append(
                  $("<img>")
                    .attr("src", '{% static "images/core/icons/star.png" %}')
                    .attr("alt", "Star icon")
                    .addClass(
                      "page-content__search-results-item-info-rating-star-icon"
                    )
                );
              }
            });

            $("#num-hotels-found").text(numHotelsFound);
          } else {
            // No hotel results found, display a message
            var message = `
              <li class="page-content__search-results-no-results">
                <p>No hotels found for the specified search parameters.</p>
              </li>
            `;

            // Append the message to the search results container
            $("#search-results-container").append(message);
            $("#num-hotels-found").text(numHotelsFound);
          }
        },
      });
    }
  });
</script>

{% load static %} {% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'images/core/favicon/favicon.ico' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'css/normalize.css' %}"
    />
    <title>my Dream Place | Search results</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'css/core/search_results.css' %}"
    />
    <!-- <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    /> -->
  </head>

  <body>
    <header class="header">
      <div class="container">
        <div class="header__background">
          <a href="{% url 'home' %}" class="header__logo-link">
            <img
              src="{% static 'images/logos/alternative_logo.svg' %}"
              class="header__logo-image"
              alt="Website logo"
            />
            <span class="header__logo-text">my Dream Place</span>
          </a>

          <nav class="header-menu">
            <ul class="header-menu__list">
              <li class="header-menu__item">
                <a href="{% url 'home' %}" class="header-menu__link">Home</a>
              </li>
              <li class="header-menu__item">
                <a href="/discover" class="header-menu__link">Discover</a>
              </li>
              <li class="header-menu__item">
                <a href="/activities" class="header-menu__link">Activities</a>
              </li>
              <li class="header-menu__item">
                <a href="/about" class="header-menu__link">About</a>
              </li>
              <li class="header-menu__item">
                <a href="/contact" class="header-menu__link">Contact</a>
              </li>
            </ul>
          </nav>
          {% if user.is_authenticated %}
          <div class="header-user-profile-container">
            <img
              src="{% static 'images/core/icons/notification.svg' %}"
              alt="User notification"
              class="header-user-profile-container__notifications-icon"
            />
            <div class="header-user-profile-container__user-avatar">
              <img
                src="{{ user.avatar.url }}"
                class="header-user-profile-container_user-photo"
                alt="User Image"
                id="dropdown-trigger"
              />
              <div
                class="header-user-profile-container__dropdown-menu"
                id="dropdown-menu"
              >
                <div
                  class="header-uer-profile-container__dropdown-menu-item-container"
                >
                  <a
                    href="/account/"
                    class="header-user-profile-container__dropdown-menu-item-link"
                  >
                    <img
                      src="{% static 'images/partials/icons/account.svg' %}"
                      alt="Account icon"
                      class="header-user-profile-container__dropdown-menu-link-item-icon"
                    />
                    <span
                      class="header-user-profile-container__dropdown-menu-link-item-text"
                      >Manage account</span
                    >
                  </a>
                </div>
                <div
                  class="header-uer-profile-container__dropdown-menu-item-container"
                >
                  <a
                    href="/reservations/"
                    class="header-user-profile-container__dropdown-menu-item-link"
                  >
                    <img
                      src="{% static 'images/partials/icons/trips.svg' %}"
                      alt="Account icon"
                      class="header-user-profile-container__dropdown-menu-link-item-icon"
                    />
                    <span
                      class="header-user-profile-container__dropdown-menu-link-item-text"
                      >My trips</span
                    >
                  </a>
                </div>
                <div
                  class="header-uer-profile-container__dropdown-menu-item-container"
                >
                  <a
                    href="/rewards/"
                    class="header-user-profile-container__dropdown-menu-item-link"
                  >
                    <img
                      src="{% static 'images/partials/icons/wallet.svg' %}"
                      alt="Account icon"
                      class="header-user-profile-container__dropdown-menu-link-item-icon"
                    />
                    <span
                      class="header-user-profile-container__dropdown-menu-link-item-text"
                      >Reward and wallet</span
                    >
                  </a>
                </div>
                <div
                  class="header-uer-profile-container__dropdown-menu-item-container"
                >
                  <a
                    href="{% url 'logout' %}"
                    class="header-user-profile-container__dropdown-menu-item-link"
                  >
                    <img
                      src="{% static 'images/partials/icons/signout.svg' %}"
                      alt="Account icon"
                      class="header-user-profile-container__dropdown-menu-link-item-icon"
                    />
                    <span
                      class="header-user-profile-container__dropdown-menu-link-item-text"
                      >Sign out</span
                    >
                  </a>
                </div>
              </div>
            </div>
          </div>
          {% else %}

          <div class="header-button-container">
            <a href="/register" class="register-link"
              ><button class="register-button">Register</button></a
            >
            <a href="/signin" class="signin-link"
              ><button class="signin-button">Sign In</button></a
            >
          </div>
          {% endif %} {% include 'partials/_search_form.html' %}
        </div>
      </div>
    </header>
    {% block content %}
    <main class="main">
      <section class="search-results">
        <div class="container">
          <div class="page-content">
            <div class="page-content__left-side">
              <div class="page-content__filters-container">
                <div
                  class="page-content__filter-search-container"
                  id="page-content__filter-search-geo"
                >
                  <h4 class="page-content__filter-search-title">
                    <b>Search by property name</b>
                  </h4>
                  <img
                    src="{% static 'images/core/icons/search.svg' %}"
                    alt="Guests icon"
                    class="page-content__filter-search-icon"
                  />
                  <input
                    type="text"
                    class="page-content__filter-search-input"
                    placeholder="e.g. Multnomah County"
                    name="q"
                  />
                  <ul class="autocomplete-result-list"></ul>
                </div>
              </div>
              <h4 class="page-content__filter-by-title">Filter by</h4>
              <div class="page-content__filter-container">
                <div class="page-content__filter-container-title">
                  <b>Your budget per day</b>
                </div>
                <ul class="page-content__filter-choice-list">
                  {% for price in price_ranges %}
                  <li>
                    <input
                      type="checkbox"
                      name="price-range"
                      value="{{ price.value }}"
                    />
                    {{ price.label }}
                    <span>{{ price.count }}</span>
                  </li>
                  {% endfor %}
                  <!-- <div
                    class="page-content__budget-per-day-filter-set-budget-switch-container"
                  >
                    <label for="set-budget">Set your own budget</label>
                    <label
                      class="page-content__budget-per-day-filter-set-budget-switch"
                    >
                      <input type="checkbox" />
                      <span
                        class="page-content__budget-per-day-filter-set-budget-switch-slider"
                      ></span>
                    </label>
                  </div> -->
                </ul>
              </div>
              <div class="page-content__filter-container">
                <div class="page-content__filter-container-title">Rating</div>
                <div class="page-content__filter-choice-list">
                  <span class="page-content__filter-container-text"
                    >Show only ratings more than</span
                  >
                  <div
                    class="page-content__filter-by-rating-choice-stars-container"
                  >
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button page-content__filter-by-rating-choice-stars-button-left"
                    >
                      1
                      <img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button"
                    >
                      2<img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button"
                    >
                      3<img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button"
                    >
                      4<img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                    <button
                      type="button"
                      class="page-content__filter-by-rating-choice-stars-button page-content__filter-by-rating-choice-stars-button-right"
                    >
                      5<img
                        src="{% static 'images/core/icons/star.png' %}"
                        alt="Star icon"
                        class="page-content__filter-by-rating-choice-stars-button-star-icon"
                      />
                    </button>
                  </div>
                </div>
              </div>
              <div class="page-content__filter-container">
                <div class="page-content__filter-container-title">
                  Popular Filters
                </div>
                <div class="page-content__filter-choice-list">
                  {% for popular_filter in popular_filters %}
                  <li>
                    <input
                      type="checkbox"
                      name="price-range"
                      value="{{ popular_filter.value }}"
                    />
                    {{ popular_filter.label }}
                    <span>{{ popular_filter.count }}</span>
                  </li>
                  {% endfor %}
                </div>
              </div>
              <div class="page-content__filter-container">
                <div class="page-content__filter-container-title">
                  Activities
                </div>
                <ul class="page-content__filter-choice-list">
                  {% for activity in activities %}
                  <li>
                    <input
                      type="checkbox"
                      name="price-range"
                      value="{{ activity.value }}"
                    />
                    {{ activity.label }}
                    <span>{{ activity.count }}</span>
                  </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
            <div class="page-content__right-side">
              <h3 class="page-content__search-results-title">
                {{ destination }}: {{ num_hotels_found }} search results found
              </h3>
              <div class="page-content__allocation-type-filter-container">
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button page-content__allocation-type-filter-button-left"
                >
                  Our top picks
                </button>
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button"
                >
                  Hotel and apartments
                </button>
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button"
                >
                  Residence
                </button>
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button"
                >
                  Resort
                </button>
                <button
                  type="submit"
                  class="page-content__allocation-type-filter-button page-content__allocation-type-filter-button-right"
                >
                  Shared Space
                </button>
                <div class="page-content__sort-by-container">
                  <span class="page-content__sort-by-container-text"
                    >Sort by:</span
                  >
                  <img
                    src="{% static 'images/core/icons/arrow-down.svg' %}"
                    alt="Arrow icon"
                    class="page-content__sort-by-container-icon"
                    id="sort-by-drop-down"
                  />
                  <span class="page-content__sort-by-container-choice"
                    >Recommended</span
                  >
                  <ul class="page-content__sort-by-drop-down-item-list">
                    <li class="page-content__sort-by-drop-down-item">
                      <span>Recommended</span>
                    </li>
                    <li class="page-content__sort-by-drop-down-item">
                      <span>Rating (high to low)</span>
                    </li>

                    <li class="page-content__sort-by-drop-down-item">
                      <span>Rating (low to high)</span>
                    </li>
                    <li class="page-content__sort-by-drop-down-item">
                      <span>Top reviewed</span>
                    </li>
                  </ul>
                </div>
              </div>
              <ul class="page-content__search-results-list">
                {% for hotel_result in hotel_results %}
                <li class="page-content__search-results-item">
                  <img
                    src="/media/{{ hotel_result.hotel_cover_photo }}"
                    alt="{{ hotel_result.hotel_name }}"
                    class="page-content__search-results-item-image"
                  />
                  <div class="page-content__search-results-item-info-container">
                    <div
                      class="page-content__search-results-item-info-title-container"
                    >
                      <h4 class="page-content__search-results-item-info-title">
                        {{ hotel_result.hotel_name }}
                      </h4>
                      
                        {% if hotel_result.total_price_with_discount != 0 %}
                      <div
                        class="page-content__search-results-item-info-title-promo__active"
                      >
                      {{ hotel_result.special_discount }}
                      </div>
                      {% else %}
                      <div
                      class="page-content__search-results-item-info-title-promo__not-active"
                    >
                    </div>
                      {% endif %}
                    </div>
                    <div
                      class="page-content__search-results-item-info-rating-container"
                    >
                      <div
                        class="page-content__search-results-item-info-rating-stars-container"
                      >
                        <img
                          src="{% static 'images/core/icons/star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon"
                        />
                        <img
                          src="{% static 'images/core/icons/star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon"
                        />
                        <img
                          src="{% static 'images/core/icons/star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon"
                        />
                        <img
                          src="{% static 'images/core/icons/star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon"
                        />
                        <img
                          src="{% static 'images/core/icons/half-star.png' %}"
                          alt="Star icon"
                          class="page-content__search-results-item-info-rating-star-icon-half"
                        />
                      </div>
                      <p
                        class="page-content__search-results-item-info-rating-stars-text"
                      >
                        4.5 (1200 Reviews)
                      </p>
                    </div>
                    <div
                      class="page-content__search-results-item-info-data-container"
                    >
                      <div
                        class="page-content__search-results-item-info-data-container-left"
                      >
                        <p
                          class="page-content__search-results-item-info-data-offer-title"
                        >
                        {{ hotel_result.hotel_search_info_title }}
                        </p>
                        <p
                          class="page-content__search-results-item-info-data-offer-text"
                        >
                        {{ hotel_result.hotel_search_info_text }}
                        </p>
                        <button
                          type="submit"
                          class="page-content__search-results-item-info-data-see-availability"
                        >
                          See availability
                        </button>
                      </div>
                      <div
                        class="page-content__search-results-item-info-data-container-right"
                      >
                      {% if hotel_result.total_price_with_discount != 0 %}
                        <div
                          class="page-content__search-results-item-info-data-discount__active"
                        >
                        {{ hotel_result.price_discount }}% off
                        </div>
                        {% else %}
                        <div
                          class="page-content__search-results-item-info-data-discount__not-active"
                        >
                        </div>
                        {% endif %}
                        <p
                          class="page-content__search-results-item-info-data-rooms-text"
                        >
                          {{ guests }} {{ duration }} days
                        </p>
                        <p
                            class="page-content__search-results-item-info-data-price-full"
                          >
                          US${{ hotel_result.total_price }}
                          </p>
                        
                        {% if hotel_result.total_price_with_discount != 0 %}
                          <p
                            class="page-content__search-results-item-info-data-price-discount__active"
                          >
                          US${{ hotel_result.total_price_with_discount }}
                          </p>
                          {% else %}
                          <div class="page-content__search-results-item-info-data-price-discount__not-active"></div>
                          {% endif %}
                          
                          <!-- <div
                          class="page-content__search-results-item-info-data-price-container"
                        > -->
                        <p
                          class="page-content__search-results-item-info-data-taxes-text"
                        >
                          Includes taxes and fees
                        </p>
                      </div>
                    </div>
                  </div>
                </li>
                {% endfor %}
              </ul>
              <div class="more-results__button-container">
                <button type="button" class="more-results__button">
                  Load more results
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="restrictions">
        <div class="container">{% include 'partials/_warning.html' %}</div>
      </section>
    </main>

    {% endblock %} {% block footer %} {% include 'partials/_footer.html' %}
    {%endblock %}
  </body>
</html>

{% if user.is_authenticated %}
<!-- Script to activate drop down menu when user clicks on the avatar -->
<script>
  // Get the avatar and dropdown menu elements by their IDs
  const avatar = document.getElementById("dropdown-trigger");
  const dropdownMenu = document.getElementById("dropdown-menu");

  // Add a click event listener to the avatar element
  avatar.addEventListener("click", function () {
    // Toggle the "show" class on the dropdown menu element to show or hide it
    dropdownMenu.classList.toggle("show");
  });

  // Add a click event listener to the document object
  document.addEventListener("click", function (event) {
    // Check if the click event occurred inside the avatar or dropdown menu elements
    const isClickInside =
      avatar.contains(event.target) || dropdownMenu.contains(event.target);
    // If the click event occurred outside of the avatar or dropdown menu elements, hide the dropdown menu
    if (!isClickInside) {
      dropdownMenu.classList.remove("show");
    }
  });
</script>
{% endif %}

<script src="{% static 'node_modules/@trevoreyre/autocomplete-js/dist/autocomplete.min.js' %}"></script>
<script>
  new Autocomplete("#page-content__filter-search-geo", {
    // The search function takes user input and returns a Promise that resolves with an array of results
    search: (input) => {
      const url = "/search/?address=" + input.trim();
      // Using fetch to send an HTTP request to the specified URL and return a Promise that resolves with the response
      return new Promise((resolve) => {
        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            resolve(data.data); // Resolving the Promise with the array of results from the response data
          });
      });
    },
  });
</script>

<script>
  const StarButtons = document.querySelectorAll(
    ".page-content__filter-by-rating-choice-stars-button"
  );

  StarButtons.forEach((button) => {
    button.addEventListener("click", () => {
      if (button.classList.contains("selected")) {
        button.classList.remove("selected");
      } else {
        StarButtons.forEach((otherButton) => {
          otherButton.classList.remove("selected");
        });
        button.classList.add("selected");
      }
    });
  });
</script>

<script>
  const AllocationButtons = document.querySelectorAll(
    ".page-content__allocation-type-filter-button"
  );

  AllocationButtons.forEach((button) => {
    button.addEventListener("click", () => {
      if (button.classList.contains("selected")) {
        button.classList.remove("selected");
      } else {
        AllocationButtons.forEach((otherButton) => {
          otherButton.classList.remove("selected");
        });
        button.classList.add("selected");
      }
    });
  });
</script>

<script>
  const dropDownList = document.querySelector(
    ".page-content__sort-by-drop-down-item-list"
  );
  const dropDownIcon = document.querySelector(
    ".page-content__sort-by-container-icon"
  );
  const sortByContainer = document.querySelector(
    ".page-content__sort-by-container"
  );
  const sortByChoice = document.querySelector(
    ".page-content__sort-by-container-choice"
  );

  // Hide the drop-down list on page load
  dropDownList.style.display = "none";

  // Toggle the drop-down list when the icon is clicked
  dropDownIcon.addEventListener("click", () => {
    if (dropDownList.style.display === "none") {
      dropDownList.style.display = "flex";
      dropDownIcon.classList.add("rotated");
    } else {
      dropDownList.style.display = "none";
      dropDownIcon.classList.remove("rotated");
    }
  });

  // Update the sort-by choice when an item is clicked
  dropDownList.addEventListener("click", (event) => {
    const selectedItem = event.target.closest("li");
    if (selectedItem) {
      sortByChoice.textContent = selectedItem.textContent.trim();
      dropDownList.style.display = "none";
      dropDownIcon.classList.remove("rotated");
    }
  });
</script>

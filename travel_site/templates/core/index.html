{% extends 'base.html' %} 
{% load static %} 
{% block title %} | Book Hotels in Oregon{% endblock%} 

{% block navigation %}
{% include 'partials/_navigation.html' %}
{% endblock %}

{% block content %}

<link rel="stylesheet" type="text/css" href="{% static 'css/core/index.css' %}" />

<link
  rel="stylesheet"
  href="{% static 'node_modules/@trevoreyre/autocomplete-js/dist/style.css' %}"
/>
<link
  rel="stylesheet"
  href="{% static 'node_modules/flatpickr/dist/flatpickr.min.css' %}"
/>

<main class="main">
  <section class="booking-search">
    <div class="container">
      <div class="booking-search__cover-photo-container">
        <img
          src="{{ cover.cover_photo.url }}"
          alt="Cover photo"
          class="booking-search__cover-photo"
        />
        <h2 class="booking-search__cover-photo-title">{{ cover.cover_title }}</h2>
        <h4 class="booking-search__cover-photo-text">
          {{ cover.cover_text }}
        </h4>
      </div>
      <form
        class="booking-search-form"
        method="get"
        action="{% url 'search_hotels' %}"
      >
        <div
          class="booking-search-form__item"
          id="booking-search-form__item-geo"
        >
        <img
        src="{% static 'images/core/icons/geo.svg' %}"
        alt="Geolocation icon"
        class="booking-search-form__item__icon"
      />
          <input
            type="text"
            class="booking-search-form__geo-input"
            id="destination"
            name="destination"
            placeholder="Where are you going?"
            required
          />
          <ul class="autocomplete-result-list"></ul>
        </div>

        <div class="booking-search-form__item booking-search-form__item__calendar">
          <img
        src="{% static 'images/core/icons/calendar.svg' %}"
        alt="Calendar icon"
        class="booking-search-form__item__icon"
      />
          <input
            type="text"
            id="checkin"
            name="checkin"
            placeholder="Check-in date"
            required
          />
        </div>
        <div class="booking-search-form__item">
          <img
        src="{% static 'images/core/icons/calendar.svg' %}"
        alt="Calendar icon"
        class="booking-search-form__item__icon"
      />
          <input
            type="text"
            id="checkout"
            name="checkout"
            placeholder="Check-out date"
            required
          />
        </div>
        <div class="booking-search-form__item" onload="setGuests()">
          <img
        src="{% static 'images/core/icons/guests.svg' %}"
        alt="Guests icon"
        class="booking-search-form__item__icon"
      />
      <input
      type="text"
      id="guests"
      name="guests"
      placeholder="Guests & Rooms"
      readonly
    />
          <div class="booking-search-form__drop-down-menu" id="guests-input-container-dropdown-menu">
            <div class="booking-search-form__drop-down-menu-item">
              <span class="booking-search-form__drop-down-menu-label">Adults</span>
              <div class="booking-search-form__drop-down-menu-choice_container">
                <button type="button" class="booking-search-form__drop-down-menu-button-minus" onclick="changeCount('adults', 'minus')" disabled>-</button>
                <span id="adults-count" class="booking-search-form__drop-down-menu-count" onchange="updateGuestsInput()">1</span>
                <button type="button" class="booking-search-form__drop-down-menu-button-plus" onclick="changeCount('adults', 'plus')">+</button>
              </div>
            </div>
            <div class="booking-search-form__drop-down-menu-item">
              <span class="booking-search-form__drop-down-menu-label">Children</span>
              <div class="booking-search-form__drop-down-menu-choice_container">
                <button type="button" class="booking-search-form__drop-down-menu-button-minus" onclick="changeCount('children', 'minus')" disabled>-</button>
                <span id="children-count" class="booking-search-form__drop-down-menu-count" onchange="updateGuestsInput()">0</span>
                <button type="button" class="booking-search-form__drop-down-menu-button-plus" onclick="changeCount('children', 'plus')">+</button>
              </div>
            </div>
            <div class="booking-search-form__drop-down-menu-item">
              <span class="booking-search-form__drop-down-menu-label">Rooms</span>
              <div class="booking-search-form__drop-down-menu-choice_container">
                <button type="button" class="booking-search-form__drop-down-menu-button-minus" onclick="changeCount('rooms', 'minus')" disabled>-</button>
                <span id="rooms-count" class="booking-search-form__drop-down-menu-count" onchange="updateGuestsInput()">1</span>
                <button type="button" class="booking-search-form__drop-down-menu-button-plus" onclick="changeCount('rooms', 'plus')">+</button>
              </div>
            </div>
          </div>
        </div>
        <button type="submit" class="booking-search-form__submit-button">Search</button>
      </form>
    </div>
  </section>
  <section class="restrictions">
    <div class="container">
      {% include 'partials/_warning.html' %}
    </div>
  </section>

  <section class="countries-list">
    <div class="container">
      <h3 class="countries-list-header">Enjoy your dream vacation</h3>
      <span class="countries-list-text"
        >Plan and book our perfect trip with expert advice, travel tips,
        destination information and inspiration from us</span
      >
      <ul class="countries-list-destinations">
        {% for destination, destination_info in available_destinations.items %}
        <li class="countries-list-destinations-box">
          <a href="{{ destination | lower }}" class="countries-list-link">
            <img src="{{ destination_info.county_photo.url }}" alt="County
            photo" class="countries-list-photo" />
            <div class="countries-list-destinations-info">
              <span class="countries-list-destinations-info-name"
                >{{ destination }}</span
              >
              <span class="countries-list-destinations-info-amount">
                {% if destination_info.hotel_count == 1 %}
                {{ destination_info.hotel_count }} property {% else %}
                {{ destination_info.hotel_count }} properties {% endif %}
              </span>
            </div>
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>
  </section>

  <section class="blog">
    <div class="container">
      <h3 class="blog-header">Get inspiration for your next trip</h3>
      <div class="blog-content">
        {% for blog in blog_info %}
        <div class="blog-content-box">
          <a href="{{ blog.get_absolute_url }}" class="countries-list-link">
            <img
              src="{{ blog.blog_photo.url }}"
              alt="Blog photo"
              class="blog-content-photo"
            />
            <div class="card-content">
              <h5 class="blog-header-content">{{ blog.blog_title }}</h5>
              <p class="blog-text-content">
                {{ blog.blog_text |truncatewords:12 }}
              </p>
            </div>
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <section class="popular-hotels">
    <div class="container">
      <h3 class="popular-hotels-title">Popular hotels</h3>
      <ul class="popular-hotels-destinations">
        {% for hotel in popular_hotels %}
        <li class="popular-hotels-destinations-box">
          <a href="#" class="popular-hotels-destinations-link">
          <img
            src="{{ hotel.hotel_cover_photo.url }}"
            alt=""
            class="popular-hotels-photo"
          />
          
          <div class="popular-hotels-destinations-info">
              <span class="popular-hotels-destinations-info-name"
                >{{ hotel.hotel_name }}</span
              >
              <span class="popular-hotels-destinations-info-amount"
                >10 rooms</span
              >
          </div>
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>
  </section>

  <section class="download-app-promo">
    <div class="container">
      <a href="/" onclick="redirectToApp()">
        <img
          src="{% static 'images/photos/app/promo_app.jpg' %}"
          alt=""
          class="promo-app-photo"
      /></a>
    </div>
  </section>
  <section class="motto">
    <div class="container">
      <img
        src="{% static 'images/photos/motto/motto.jpg' %}"
        alt=""
        class="motto-photo"
      />
    </div>
  </section>

  <script>
    const guest = document.getElementById("guests");
    const guestdropdownMenu = document.getElementById("guests-input-container-dropdown-menu");
  
    guest.addEventListener("click", function () {
      guestdropdownMenu.classList.toggle("show");
    });
  
    document.addEventListener("click", function (event) {
      const isClickInside =
      guest.contains(event.target) || guestdropdownMenu.contains(event.target);
      if (!isClickInside) {
        guestdropdownMenu.classList.remove("show");
      }
    });
  </script>

  <script>
    function redirectToApp() {
      // Replace this URL with your mobile app link
      var appUrl = "/";
      var userAgent = navigator.userAgent.toLowerCase();

      // Check if the user agent is from an iOS device
      if (
        userAgent.indexOf("iphone") !== -1 ||
        userAgent.indexOf("ipad") !== -1
      ) {
        // Open the app in iOS using a custom URL scheme
        window.location.href = "https://apps.apple.com/ru/app/";
      }
      // Check if the user agent is from an Android device
      else if (userAgent.indexOf("android") !== -1) {
        // Open the app in Android using an intent URL
        window.location.href = "https://play.google.com/store/apps/";
      }
      // Check if the user agent is from a Windows device
      else if (userAgent.indexOf("windows") !== -1) {
        // Redirect to the app's website or app store page for Windows users
        window.location.href = appUrl;
      }
      // Redirect to the app store if the app is not installed on other devices
      else {
        window.location.href = appUrl;
      }
    }
  </script>

  <script>
function changeCount(type, operation) {
  var countEl = document.getElementById(type + "-count");
  var count = parseInt(countEl.innerHTML);
  var minusButton = document.querySelector(`button.booking-search-form__drop-down-menu-button-minus[onclick="changeCount('${type}', 'minus')"]`);
  var plusButton = document.querySelector(`button.booking-search-form__drop-down-menu-button-plus[onclick="changeCount('${type}', 'plus')"]`);
  
  if (operation === "minus") {
    if (count > 0) {
      count--;
    }
  } else if (operation === "plus") {
    if (count < 30) {
      count++;
    }
  }
  
  countEl.innerHTML = count;
  setGuests();
  
  // Disable minus button if count is at its minimum value
  if (type === "adults" && count === 1) {
    minusButton.disabled = true;
  } else if (type === "children" && count === 0) {
    minusButton.disabled = true;
  } else if (type === "rooms" && count === 1) {
    minusButton.disabled = true;
  } else {
    minusButton.disabled = false;
  }
  
  // Disable plus button if count is at its maximum value
  if (count === 30) {
    plusButton.disabled = true;
  } else {
    plusButton.disabled = false;
  }
}

function setGuests() {

  var adults = document.getElementById('adults-count').textContent;
  var children = document.getElementById('children-count').textContent;
  var rooms = document.getElementById('rooms-count').textContent;
  var totalGuests = parseInt(adults) + parseInt(children);
  var guestsLabel = (totalGuests === 1) ? ' guest' : ' guests';
  var roomsLabel = (rooms === '1') ? ' room' : ' rooms';
  document.getElementById('guests').value = totalGuests + guestsLabel + ' · ' + rooms + roomsLabel;

}

  </script>

  <script src="{% static 'node_modules/flatpickr/dist/flatpickr.js' %}"></script>
  <script>
  // Get a reference to the trigger elements
  const checkIn = document.getElementById("checkin");
  const checkOut = document.getElementById("checkout");

  // Calculate maxDate (today + 1 year)
  const maxDate = new Date();
  maxDate.setFullYear(maxDate.getFullYear() + 1);

  // Initialize Flatpickr with "altInput" option
  flatpickr(checkOut, {
    altInput: checkOut,
    minDate: "today",
    maxDate: maxDate,
    dateFormat: "d-m-Y",
    onClose: function(selectedDates, dateStr, instance) {
      // If check-in date is after check-out date, reset check-in date
      if (checkIn.value != "" && selectedDates[0] >= new Date(checkIn.value)) {
        instance.clear();
        checkIn._flatpickr.set("minDate", dateStr);
      } else {
        checkIn._flatpickr.set("minDate", "today");
        checkIn._flatpickr.set("maxDate", dateStr);
      }
    }
  });

  flatpickr(checkIn, {
    altInput: checkIn,
    minDate: "today",
    dateFormat: "d-m-Y",
    onClose: function(selectedDates, dateStr, instance) {
      // If check-out date is before check-in date, reset check-out date
      if (checkOut.value != "" && selectedDates[0] >= new Date(checkOut.value)) {
        instance.clear();
        checkOut._flatpickr.set("minDate", dateStr);
      } else {
        checkOut._flatpickr.set("minDate", dateStr);
        checkOut._flatpickr.set("maxDate", maxDate);
      }
    }
  });
  </script>

  <script src="{% static 'node_modules/@trevoreyre/autocomplete-js/dist/autocomplete.min.js' %}"></script>
  <script>
    new Autocomplete("#booking-search-form__item-geo", {
      search: (input) => {
        const url = "/search/?address=" + input.trim();
        return new Promise((resolve) => {
          fetch(url)
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
              resolve(data.data);
            });
        });
      },
    });
  </script>
</main>
{% endblock %}

{% block footer %}
    {% include 'partials/_footer.html' %}
    {% endblock %}
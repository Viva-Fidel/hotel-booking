{% extends 'base.html' %} 
{% load static %} 
{% load widget_tweaks %}
{% block title %} 
{% if request.path == '/register/' %}
 | Registration 
{% elif request.path == '/signin/' %}
  | Sign In 
{% elif request.path == '/password_reset/' %}
  | Restore password
{% elif request.path == '/password_reset/done' %}
  | Restore password
{% endif %} 
{% endblock %} 
{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<link rel="stylesheet" type="text/css" href="{% static 'css/authpage.css' %}" />

<section class="authentification">
  <div class="authentification-form-box" id="authentification-form">
    
    {% if request.path == '/register/' %}
    <form class="authentification-form" method="POST">
    <h3 class="authentification-title">{{ register_title }}</h3>
      {% csrf_token %}
      <label class="top-form-text">Email address</label>
    {{ form.email | attr:"class:form-input" }}
    <div class="error-message" id="email-error-message">{{ form.email.errors.0 }}</div> 
    <button type="submit" class="submit-btn"  id="continue-with-email-btn">{{ button }}
    </button> 
    {% include 'partials/_third_party_auth.html' %}
    <span class="have-an-account-text">
      Already have an account? 
      <a href="/signin" class="sign-in-link">Sign in</a>
    </span>
  </form>


  <form class="password-creation-form" method="POST">
    <h3 class="authentification-title">{{ create_password_title }}</h3>
    <p class="password-creation-guide">Use a minimum of 10 characters, including letters, lowercase and uppercase letters, and numbers.</p>
      {% csrf_token %}
      <label class="top-form-text">Password</label>
      <input type="password" name="password" class="form-input" id="password1" required />
      <div class="error-message" id="passwor1-error-message">{{ form.password.errors.0 }}</div> 
      <label class="bottom-form-text">Confirm Password</label>
      <input
        type="password"
        name="confirm_password"
        class="form-input"
        id="password2"
        required
      /> 
      <div class="error-message" id="passwor2-error-message">{{ form.password.errors.0 }}</div>
      <button type="submit" class="submit-btn" id="create-user-btn">Create account</button>
      <span class="terms-text">By creating an account, you agree with our <a href="" class="terms-link">Terms and Conditions</a> and <a href="" class="terms-link">Privacy Statement.</a></span>
    </form>
  </div>





    <script>
      $.ajaxSetup({
        headers: { "X-CSRFToken": '{{csrf_token}}' }
      });
      
      function validate_email() {
          $.ajax({
              url : " ", 
              type : "POST", 
              data : { email : $('.form-input').val() }, 
      
              success : function(response) {
                  if (response.success) {
                    var email = $('.form-input').val();
                      $('.authentification-form').hide();
                      $('.password-creation-form').show();
      
                  } else {
                      var errors = response.errors;
                      $("#email-error-message").empty();
                      for (var field in errors) {
                          if (errors.hasOwnProperty(field)) {
                            var errorMessages = errors[field];
                      if (errorMessages.length > 0) {
                                  $("#email-error-message").prepend(errorMessages[0]);
                              }
                          }
                      }
                  }
              },
          });
      };
      
      
      function create_user() {
          var email = $('.form-input').val();
          var password1 = $('#password1').val();
          var password2 = $('#password2').val();
      
          $.ajax({
              url: " ",
              type: "POST",
              data: {
                  email: email,
                  password1: password1,
                  password2: password2
              },
              success: function(response) {
                  if (response.success) {
                    window.location.replace("/");
                  } else {
                      var errors = response.errors;
                      $("#passwor1-error-message").empty();
                      $("#passwor2-error-message").empty();
                      for (var field in errors) {
                          if (errors.hasOwnProperty(field)) {
                            var errorMessages = errors[field];
                      if (errorMessages.length > 0) {
                                  $("#passwor1-error-message").prepend( errorMessages[0]);
                                  $("#passwor2-error-message").prepend( errorMessages[0]);
                                }
                          }
                      }
                  }
              },
          });
      };
      
      
      $('#continue-with-email-btn').on('click', function(event) {
          event.preventDefault();
          validate_email();
      });
      
      $('#create-user-btn').on('click', function(event) {
          event.preventDefault();
          create_user();
      });
      
      </script>


    

    
    
      {% elif request.path == '/signin/' %}
    <h3 class="authentification-title">{{ title }}</h3>
    <form class="email-form" method="POST">
      <label class="top-form-text">Email address</label>
      {% csrf_token %}
    {{ form.email | attr:"class:form-input" }} 
    <div class="error-message" id="email-error-message">{{ form.email.errors.0 }}</div>
    <label class="bottom-form-text">Password</label>
    <input
      type="password"
      id="id_password3"
      name="password"
      class="form-input"
      required
    />
    <div class="error-message" id="email-error-message">{{ form.email.errors.0 }}</div>
    <div class="checkbox-signin-restore">
      <input type="checkbox" id="keep-signed-in" name="keep-signed-in" />
      <label class="signin-checkbox-text" for="keep-signed-in"
        >Keep me signed in</label
      >
      <a href="/password_reset/" class="forgot-password-link">Forgot password?</a>
    </div>
    <button type="submit" class="email-submit" id="continue-with-email-btn-signin">Continue with Email
    </button>

    <div class="email-options-wrapper">
      <div class="horizontal-line"></div>
      <span class="email-options-text">or use one of these options</span>
      <div class="horizontal-line"></div>
    </div>
    {% load socialaccount %} 
    <a href="{% provider_login_url 'google'%}">
      <button type="button" class="login-with-google-btn">
        Continue with Google
      </button>
    </a>
    <a href="{% provider_login_url 'github'%}">
      <button type="button" class="login-with-github-btn">
        Continue with GitHub
      </button>
    </a>
  </form>
    <span class="have-an-account-text">
      Already have an account? {% if request.path == '/signin/' %}
      <a href="/register" class="sign-in-link">Register</a>
      {% elif request.path == '/register/' %}
      <a href="/signin" class="sign-in-link">Sign in</a>
      {% endif %}
    </span>
    

     
      {% elif request.path == '/password_reset/' %}
      <h3 class="authentification-title">{{ title }}</h3>
      <p class="password-creation-guide">Weâ€™ll send you a link to reset it. Enter your email address used for My Dream Place.</p>
      <form class="password-form" method="post">
        {% csrf_token %}
        <label class="top-form-text">Your email address</label>
      <!-- <input type="email" id="email" name="email" class="form-input" required /> -->
      {{ form.email | attr:"class:form-input" }} 
      <div class="error-message" id="email-error-message">{{ form.email.errors.0 }}</div>
      <button type="submit" class="email-submit" id="reset-link-btn">
          Send Reset Link
        </button>
        <span class="terms-text">By creating an account, you agree with our <a href="" class="terms-link">Terms and Conditions</a> and <a href="" class="terms-link">Privacy Statement</a>.</span>
      </form>
    {% elif request.path == '/password_reset/done/' %}
    <div class="authentification-form-box" id="forgot-email-sent">
      <div class="img-background"><img
          src="{% static 'images/icons/restore_password.svg' %}"
          alt="Main page photo"
          class="booking_photo"
        /></div>
      
      <h3 class="authentification-title">Check your Inbox</h3>
      <p class="check-check-inbox-text">We have just emailed you the instrustions and a reset password link to <b>Sumail_john@gmail.com</b>. It might take a few minutes to arrive</p>
      <button type="submit" class="email-submit" id="reset-link-btn">
        Back to Sign in
        </button>
    </div>
  
  </div>
    {% endif %}
   
  

  
  
</section>



{% if request.path == '/register/' %}


{% elif request.path == '/signin/' %}

<script>
  $.ajaxSetup({
    headers: { "X-CSRFToken": '{{csrf_token}}' }
  });

  
  function signin_user() {
      var email = $('.form-input').val();
      var password = $('#id_password3').val();
      var keep_signed_in = $('#keep-signed-in').prop('checked');

      $.ajax({
          url: " ",
          type: "POST",
          data: {
              email: email,
              password: password,
              keep_signed_in: keep_signed_in
          },
          success: function(response) {
              if (response.success) {
                window.location.replace("http://127.0.0.1:8000/");
              } else {
                  var errors = response.errors;
                  $("#email-error-message").empty();
                  for (var field in errors) {
                      if (errors.hasOwnProperty(field)) {
                        var errorMessages = errors[field];
                  if (errorMessages.length > 0) {
                    $("#email-error-message").prepend(errorMessages[0]);
                            }
                      }
                  }
              }
          },
      });
  };
  
  
  $('#continue-with-email-btn-signin').on('click', function(event) {
      event.preventDefault();
      signin_user();
  });
</script>



{% elif request.path == '/password_reset/' %}
<script>
  $.ajaxSetup({
    headers: { "X-CSRFToken": '{{csrf_token}}' }
  });

  
  function restore_password() {
      var email = $('.form-input').val();

      $.ajax({
          url: " ",
          type: "POST",
          data: {
              email: email
          },
          success: function(response) {
              if (response.success) {
                window.location.replace("/password_reset/done/");
              } else {
                  var errors = response.errors;
                  $("#email-error-message").empty();
                  for (var field in errors) {
                      if (errors.hasOwnProperty(field)) {
                        var errorMessages = errors[field];
                  if (errorMessages.length > 0) {
                    $("#email-error-message").prepend(errorMessages[0]);
                            }
                      }
                  }
              }
          },
      });
  };
  
  
  $('#reset-link-btn').on('click', function(event) {
      event.preventDefault();
      restore_password();
  });
</script> 


{% endif %}

  
{% endblock %}
